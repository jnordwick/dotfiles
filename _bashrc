# ~/.bashrc

[[ $- != *i* ]] && return

function shload {
    local s="$(realpath -m ~/.bash.d/$1)"
    local b="$(basename -s .SH -- ${s^^})"
    local -n v="SHLOAD_${b//[^a-zA-Z0-9]/_}"
    if [[ -e "$s" ]]; then
        source "$s" "${@:2}"
        v="$?"
    else
        echo "shload: $s not found at line $(caller)" >&2
        v=-1
    fi
}

shload bash-saveline.sh
# shload bash-mdirs.sh

[ -r /usr/share/bash-completion/bash_completion ] && . /usr/share/bash-completion/bash_completion

alias grep='grep --colour=auto'
alias egrep='egrep --colour=auto'
alias fgrep='fgrep --colour=auto'

set -o ignoreeof
shopt -s checkwinsize expand_aliases

export PAGER=less
export LESS='-RFXi'

HISTSIZE=50000
SAVEHIST=50000
HISTIGNORE=exit:bg:fg:history:pwd:jobs
HISTCONTROL=ignoreboth
shopt -s histappend

#function _emacspick {
#  if [[ -S /var/run/user/${UID}/emacs/server ]]; then
#    emacsclient "$@"
##  else
#    emacs "$@"
#  fi
#}

# high dpi -- fractional currently broken
#export GDK_SCALE=1.25
#export COGL_ATLAS_DEFAULT_BLIT_MODE=framebuffer

# somne in zsh these are getting overwriten so have to come after
#alias lsbase='exa --group-directories-first --color=always'
#function lsbase {
#  exa --group-directories-first --color=always -s=Name -Fh "$@"
#}
alias _lsb='exa --group-directories-first --color=always -s=Name -Fh'
alias ls='_lsb --grid'
alias ll='_lsb --icons --git --extended --long'
alias la='_lsb --icons --git -aa'
alias lw='_lsb --grid'
alias lla='ll -aa'
alias lwa='ls --grid -aa'

alias kk='kde-open'

# run QT stuff with logging
qtlog () {
  local -x QT_LOGGING_RULES=qt.qpa.screen.debug=true
  local -x QT_AUTO_SCREEN_SCALE_FACTOR=1
  local -x QT_SCREEN_SCALE_FACTORS=
  "$@"
}

export EDITOR=vim
export VISUAL=vim
alias vi=vim
alias v=vim

#alias emacs=_emacspick
alias eec="vim ~/.doom.d/config.el"
alias vvc='vim ~/.bashrc'

alias pp=pushd
alias px=popd

export PNPM_HOME="/home/jason/.local/share/pnpm"
export GOPATH=~/go

export PATH="~/bin:~/.local/bin:$PNPM_HOME:~/.emacs.d/bin:$PATH"

alias n='ninja -j 1 -k 1 -C ~/cdev/dts/build/ -f build-Debug.ninja'

shload bash-prompt.sh

stty -ixon


